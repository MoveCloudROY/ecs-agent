# Component Reference

This page documents all 12 core component dataclasses used in the ECS agent architecture. All components use `@dataclass(slots=True)` for memory efficiency and can be imported from `ecs_agent.components`.

## Core Agent Components

### LLMComponent
Links an agent to an LLM provider for reasoning and planning.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `provider` | `LLMProvider` | (none) | The LLM provider instance |
| `model` | `str` | (none) | The specific model identifier |
| `system_prompt` | `str` | `""` | Optional system prompt override |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import LLMComponent
from ecs_agent.providers.openai_provider import OpenAIProvider

world.add_component(agent, LLMComponent(
    provider=OpenAIProvider(api_key="..."),
    model="gpt-4o",
    system_prompt="You are a helpful assistant."
))
```

### ConversationComponent
Maintains the full history of messages for an agent's conversation.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `messages` | `list[Message]` | (none) | History of conversation messages |
| `max_messages` | `int` | `100` | Maximum number of messages to retain |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `MemorySystem`, `CollaborationSystem`, `ToolExecutionSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import ConversationComponent
world.add_component(agent, ConversationComponent(messages=[]))
```

### SystemPromptComponent
Defines the base system prompt used to guide LLM behavior.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `content` | `str` | (none) | The system prompt text |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import SystemPromptComponent
world.add_component(agent, SystemPromptComponent(content="You are a specialized code reviewer."))
```

## Tool Components

### ToolRegistryComponent
Stores the definitions and execution handlers for all tools available to the agent.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `tools` | `dict[str, ToolSchema]` | (none) | Mapping of tool names to their schemas |
| `handlers` | `dict[str, Callable[..., Awaitable[str]]]` | (none) | Async handlers for tool execution |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `ToolExecutionSystem`

**Usage:**
```python
from ecs_agent.components import ToolRegistryComponent
world.add_component(agent, ToolRegistryComponent(tools=tools, handlers=handlers))
```

### PendingToolCallsComponent
Captures tool calls generated by reasoning or planning that are waiting for execution.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `tool_calls` | `list[ToolCall]` | (none) | List of requested tool calls |

**Added by:** `ReasoningSystem`, `PlanningSystem`  
**Consumed by:** `ToolExecutionSystem` (removes the component after processing)

**Usage:**
```python
from ecs_agent.components import PendingToolCallsComponent
world.add_component(agent, PendingToolCallsComponent(tool_calls=requested_calls))
```

### ToolResultsComponent
Holds the output results of executed tool calls before they are returned to the conversation.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `results` | `dict[str, str]` | (none) | Mapping of call ID to result string |

**Added by:** `ToolExecutionSystem`

**Usage:**
```python
from ecs_agent.components import ToolResultsComponent
world.add_component(agent, ToolResultsComponent(results={"call_1": "Success output"}))
```

## Planning Components

### PlanComponent
Maintains a ReAct plan, tracking individual steps and completion status.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `steps` | `list[str]` | (none) | Sequential list of plan steps |
| `current_step` | `int` | `0` | Current active step index |
| `completed` | `bool` | `False` | Completion flag for the plan |

**Used by:** `PlanningSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import PlanComponent
world.add_component(agent, PlanComponent(steps=["Analyze", "Execute", "Verify"]))
```

## Collaboration Components

### CollaborationComponent
Manages multi-agent interactions, peer lists, and message queues.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `peers` | `list[EntityId]` | (none) | IDs of collaborating peers |
| `inbox` | `list[tuple[EntityId, Message]]` | (none) | Incoming messages from other agents |

**Used by:** `CollaborationSystem`

**Usage:**
```python
from ecs_agent.components import CollaborationComponent
world.add_component(agent, CollaborationComponent(peers=[peer_id], inbox=[]))
```

## State & Lifecycle Components

### ErrorComponent
Captures diagnostic information when a system encounters an exception.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `error` | `str` | (none) | The error message or traceback |
| `system_name` | `str` | (none) | System that triggered the error |
| `timestamp` | `float` | (none) | Unix timestamp of occurrence |

**Added by:** `ReasoningSystem`, `PlanningSystem` on failure  
**Consumed by:** `ErrorHandlingSystem` (processed and then removed)

**Usage:**
```python
import time
from ecs_agent.components import ErrorComponent
world.add_component(agent, ErrorComponent(
    error="API key expired",
    system_name="ReasoningSystem",
    timestamp=time.time()
))
```

### TerminalComponent
A marker component that signifies the agent has finished its task.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `reason` | `str` | (none) | Final completion status or reason |

**Checked by:** Runner loop to determine when to stop execution.

**Usage:**
```python
from ecs_agent.components import TerminalComponent
world.add_component(agent, TerminalComponent(reason="Task goal reached."))
```

### OwnerComponent
Establishes a hierarchical relationship between entities.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `owner_id` | `EntityId` | (none) | ID of the parent/owner entity |

**Usage:**
```python
from ecs_agent.components import OwnerComponent
world.add_component(child, OwnerComponent(owner_id=root_agent_id))
```

### KVStoreComponent
Provides a generic key-value store for custom system memory.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `store` | `dict[str, Any]` | (none) | Backing dictionary for storage |

**Used by:** Available for custom implementations and extensions.

**Usage:**
```python
from ecs_agent.components import KVStoreComponent
world.add_component(agent, KVStoreComponent(store={"count": 5}))
```
