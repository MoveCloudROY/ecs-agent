# Component Reference

This page documents all 24 core component dataclasses used in the ECS agent architecture. All components use `@dataclass(slots=True)` for memory efficiency and can be imported from `ecs_agent.components`.

## Core Agent Components

### LLMComponent
Links an agent to an LLM provider for reasoning and planning.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `provider` | `LLMProvider` | (none) | The LLM provider instance |
| `model` | `str` | (none) | The specific model identifier |
| `system_prompt` | `str` | `""` | Optional system prompt override |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import LLMComponent
from ecs_agent.providers.openai_provider import OpenAIProvider

world.add_component(agent, LLMComponent(
    provider=OpenAIProvider(api_key="..."),
    model="gpt-4o",
    system_prompt="You are a helpful assistant."
))
```

### ConversationComponent
Maintains the full history of messages for an agent's conversation.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `messages` | `list[Message]` | (none) | History of conversation messages |
| `max_messages` | `int` | `100` | Maximum number of messages to retain |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `MemorySystem`, `CollaborationSystem`, `ToolExecutionSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import ConversationComponent
world.add_component(agent, ConversationComponent(messages=[]))
```

### SystemPromptComponent
Defines the base system prompt used to guide LLM behavior.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `content` | `str` | (none) | The system prompt text |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import SystemPromptComponent
world.add_component(agent, SystemPromptComponent(content="You are a specialized code reviewer."))
```

## Tool Components

### ToolRegistryComponent
Stores the definitions and execution handlers for all tools available to the agent.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `tools` | `dict[str, ToolSchema]` | (none) | Mapping of tool names to their schemas |
| `handlers` | `dict[str, Callable[..., Awaitable[str]]]` | (none) | Async handlers for tool execution |

**Used by:** `ReasoningSystem`, `PlanningSystem`, `ToolExecutionSystem`

**Usage:**
```python
from ecs_agent.components import ToolRegistryComponent
world.add_component(agent, ToolRegistryComponent(tools=tools, handlers=handlers))
```

### PendingToolCallsComponent
Captures tool calls generated by reasoning or planning that are waiting for execution.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `tool_calls` | `list[ToolCall]` | (none) | List of requested tool calls |

**Added by:** `ReasoningSystem`, `PlanningSystem`  
**Consumed by:** `ToolExecutionSystem` (removes the component after processing)

**Usage:**
```python
from ecs_agent.components import PendingToolCallsComponent
world.add_component(agent, PendingToolCallsComponent(tool_calls=requested_calls))
```

### ToolResultsComponent
Holds the output results of executed tool calls before they are returned to the conversation.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `results` | `dict[str, str]` | (none) | Mapping of call ID to result string |

**Added by:** `ToolExecutionSystem`

**Usage:**
```python
from ecs_agent.components import ToolResultsComponent
world.add_component(agent, ToolResultsComponent(results={"call_1": "Success output"}))
```

## Planning Components

### PlanComponent
Maintains a ReAct plan, tracking individual steps and completion status.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `steps` | `list[str]` | (none) | Sequential list of plan steps |
| `current_step` | `int` | `0` | Current active step index |
| `completed` | `bool` | `False` | Completion flag for the plan |

**Used by:** `PlanningSystem`, `ReplanningSystem`

**Usage:**
```python
from ecs_agent.components import PlanComponent
world.add_component(agent, PlanComponent(steps=["Analyze", "Execute", "Verify"]))
```

## Collaboration Components

### CollaborationComponent
Manages multi-agent interactions, peer lists, and message queues.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `peers` | `list[EntityId]` | (none) | IDs of collaborating peers |
| `inbox` | `list[tuple[EntityId, Message]]` | (none) | Incoming messages from other agents |

**Used by:** `CollaborationSystem`

**Usage:**
```python
from ecs_agent.components import CollaborationComponent
world.add_component(agent, CollaborationComponent(peers=[peer_id], inbox=[]))
```

## State & Lifecycle Components

### ErrorComponent
Captures diagnostic information when a system encounters an exception.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `error` | `str` | (none) | The error message or traceback |
| `system_name` | `str` | (none) | System that triggered the error |
| `timestamp` | `float` | (none) | Unix timestamp of occurrence |

**Added by:** `ReasoningSystem`, `PlanningSystem` on failure  
**Consumed by:** `ErrorHandlingSystem` (processed and then removed)

**Usage:**
```python
import time
from ecs_agent.components import ErrorComponent
world.add_component(agent, ErrorComponent(
    error="API key expired",
    system_name="ReasoningSystem",
    timestamp=time.time()
))
```

### TerminalComponent
A marker component that signifies the agent has finished its task.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `reason` | `str` | (none) | Final completion status or reason |

**Checked by:** Runner loop to determine when to stop execution.

**Usage:**
```python
from ecs_agent.components import TerminalComponent
world.add_component(agent, TerminalComponent(reason="Task goal reached."))
```

### OwnerComponent
Establishes a hierarchical relationship between entities.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `owner_id` | `EntityId` | (none) | ID of the parent/owner entity |

**Usage:**
```python
from ecs_agent.components import OwnerComponent
world.add_component(child, OwnerComponent(owner_id=root_agent_id))
```

### KVStoreComponent
Provides a generic key-value store for custom system memory.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `store` | `dict[str, Any]` | (none) | Backing dictionary for storage |

**Used by:** Available for custom implementations and extensions.

**Usage:**
```python
from ecs_agent.components import KVStoreComponent
world.add_component(agent, KVStoreComponent(store={"count": 5}))
```

## Advanced & Feature-Specific Components

### ToolApprovalComponent
Configures how tool calls are approved or denied before execution.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `policy` | `ApprovalPolicy` | (none) | `ALWAYS_APPROVE`, `ALWAYS_DENY`, or `REQUIRE_APPROVAL` |
| `timeout` | `float | None` | `30.0` | Seconds to wait for human approval in `REQUIRE_APPROVAL` mode |
| `approved_calls` | `list[str]` | `[]` | History of approved tool call IDs |
| `denied_calls` | `list[str]` | `[]` | History of denied tool call IDs |
,
**Used by:** `ToolApprovalSystem`

**Usage:**
```python
from ecs_agent.components import ToolApprovalComponent
from ecs_agent.types import ApprovalPolicy

world.add_component(agent, ToolApprovalComponent(policy=ApprovalPolicy.REQUIRE_APPROVAL, timeout=60.0))
```

### SandboxConfigComponent
Defines execution limits for code-running tools or sandboxed environments.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `timeout` | `float` | `30.0` | Maximum execution time in seconds |
| `max_output_size` | `int` | `10000` | Maximum allowed size of execution output in bytes |
**Used by:** Tools using `Sandbox` logic.

**Usage:**
```python
from ecs_agent.components import SandboxConfigComponent
world.add_component(agent, SandboxConfigComponent(timeout=10.0, max_output_size=5000))
```

### PlanSearchComponent
Configures Monte Carlo Tree Search (MCTS) for finding the optimal plan path.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `max_depth` | `int` | `5` | Maximum search depth in the MCTS tree |
| `max_branching` | `int` | `3` | Maximum number of child nodes to expand per parent |
| `exploration_weight` | `float` | `1.414` | UCB1 exploration constant |
| `best_plan` | `list[str]` | `[]` | The best plan path found after search completes |
| `search_active` | `bool` | `False` | Internal flag indicating search is in progress |
**Used by:** `TreeSearchSystem` (mutually exclusive with `PlanComponent`)

**Usage:**
```python
from ecs_agent.components import PlanSearchComponent
world.add_component(agent, PlanSearchComponent(max_depth=10, max_branching=5))
```

### RAGTriggerComponent
Triggers a vector search and stores the retrieved document snippets.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `query` | `str` | `""` | The search query string; cleared after retrieval |
| `top_k` | `int` | `5` | Number of documents to retrieve |
| `retrieved_docs` | `list[str]` | `[]` | Snippets of retrieved text |
,
**Used by:** `RAGSystem`

**Usage:**
```python
from ecs_agent.components import RAGTriggerComponent
world.add_component(agent, RAGTriggerComponent(query="How to use ECS?", top_k=3))
```

### EmbeddingComponent
Provides an entity with access to an embedding provider.
,
| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `provider` | `EmbeddingProvider` | (none) | The embedding provider instance |
| `dimension` | `int` | `0` | Expected vector dimension |
,
**Used by:** `RAGSystem`

**Usage:**
```python
from ecs_agent.components import EmbeddingComponent
from ecs_agent.providers.fake_embedding_provider import FakeEmbeddingProvider

world.add_component(agent, EmbeddingComponent(provider=FakeEmbeddingProvider(), dimension=384))
```

### VectorStoreComponent
Links an entity to a vector store for storage and retrieval.
,
| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `store` | `VectorStore` | (none) | The vector store instance |
,
**Used by:** `RAGSystem`
,
**Usage:**
```python
from ecs_agent.components import VectorStoreComponent
from ecs_agent.providers.vector_store import InMemoryVectorStore

world.add_component(agent, VectorStoreComponent(store=InMemoryVectorStore(dimension=384)))
```

### StreamingComponent
Enables system-level streaming output for an entity's LLM responses.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `enabled` | `bool` | `False` | Whether streaming is active for this entity |

**Used by:** `ReasoningSystem` (checks this to decide streaming vs batch mode)

**Usage:**
```python
from ecs_agent.components import StreamingComponent
world.add_component(agent, StreamingComponent(enabled=True))
```

### CheckpointComponent
Stores snapshots of world state for undo/restore operations.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `snapshots` | `list[dict[str, Any]]` | `[]` | Stack of serialized world state snapshots |
| `max_snapshots` | `int` | `10` | Maximum number of snapshots to retain |

**Used by:** `CheckpointSystem`

**Usage:**
```python
from ecs_agent.components import CheckpointComponent
world.add_component(agent, CheckpointComponent(max_snapshots=5))
```

### CompactionConfigComponent
Configures when and how conversation compaction occurs.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `threshold_tokens` | `int` | (none) | Token count threshold triggering compaction |
| `summary_model` | `str` | (none) | Model to use for generating summaries |

**Used by:** `CompactionSystem`

**Usage:**
```python
from ecs_agent.components import CompactionConfigComponent
world.add_component(agent, CompactionConfigComponent(threshold_tokens=4000, summary_model="qwen-plus"))
```

### ConversationArchiveComponent
Stores archived conversation summaries created by compaction.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `archived_summaries` | `list[str]` | `[]` | List of past conversation summaries |

**Used by:** `CompactionSystem`

**Usage:**
```python
from ecs_agent.components import ConversationArchiveComponent
world.add_component(agent, ConversationArchiveComponent())
```

### RunnerStateComponent
Tracks the current state of the runner execution on an entity.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `current_tick` | `int` | (none) | Current tick number in the runner loop |
| `is_paused` | `bool` | `False` | Whether the runner is paused |
| `checkpoint_path` | `str | None` | `None` | Path to the last saved checkpoint file |

**Used by:** `Runner.save_checkpoint()`, `Runner.load_checkpoint()`

**Usage:**
```python
from ecs_agent.components import RunnerStateComponent
# Usually added automatically by Runner, but can be pre-configured
world.add_component(agent, RunnerStateComponent(current_tick=0))
```

### UserInputComponent
Enables an entity to request and receive async user input.

| Name | Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `prompt` | `str` | `""` | The prompt to display to the user |
| `future` | `asyncio.Future[str] | None` | `None` | Future that resolves with user input |
| `timeout` | `float | None` | `None` | Seconds to wait; `None` for infinite wait |
| `result` | `str | None` | `None` | The received user input |

**Used by:** `UserInputSystem`

**Usage:**
```python
from ecs_agent.components import UserInputComponent
world.add_component(agent, UserInputComponent(prompt="Enter your name: ", timeout=None))
```